{"version":3,"sources":["../../../src/dragon/router/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\n\n/**\n * Module Dependencies\n *\n * @ignore\n */\nimport EventEmitter from '../events'\nimport mixin       from '../mixin'\nimport Route       from './route'\nimport utils       from '../utils'\n\n/**\n * Router Class\n *\n * @public\n * @class Router\n */\nclass Router {\n\n  constructor(options = {}) {\n    this.uid = utils.uniqueId(this)\n\n    // TODO: figure out how to mixin this\n    var eventEmitter = new EventEmitter()\n\n    this.emit  = eventEmitter.emitEvent.bind(eventEmitter)\n    this.on    = eventEmitter.addListener.bind(eventEmitter)\n    this.once  = eventEmitter.addOnceListener.bind(eventEmitter)\n    this.off   = eventEmitter.removeListener.bind(eventEmitter)\n\n    this._currentHandler = null\n    this._currentUrl     = null\n    this._debug          = options.debug || false\n    this._history        = window.history\n    this._location       = window.location\n    this._routes         = []\n    this._started        = false\n\n    this.desposed = false\n\n    this.options = options\n\n    if(!this.options.routes) return console.error('Router needs routes')\n    this.loadRoutes()\n\n    document.addEventListener('click', this.onLinkClick.bind(this), false)\n\n  }\n\n  back() {\n    window.history.back()\n  }\n\n  dispose() {\n\n    if(!this.disposed) {\n\n      this.stop()\n\n      document.removeEventListener('click', this.onLinkClick, false)\n\n      utils.dispose(this)\n\n    }\n\n  }\n\n  forward() {\n    window.history.forward()\n  }\n\n  get(pattern, options = {}) {\n\n    var route = new Route(pattern)\n\n    this._routes.push({route, options})\n\n    /*let forwardPath = arguments[1]\n\n    // Forward route\n    if(typeof forwardPath == 'string') {\n\n      this.navigate(forwardPath)\n      return\n    }\n\n    return this.router.get(path, (req, next) => {\n\n      this.currentHandler = handler\n\n      handler.call(this.router, req, next)\n\n    })*/\n\n  }\n\n  getPath() {\n\n    //path.charAt(0) === '/' ? path.slice(1) : path;\n    return window.location.pathname\n\n  }\n\n  isIgnoredLink(el) {\n\n    var href = el.getAttribute('href'),\n        rel  = el.getAttribute('rel')\n\n    if(!href || href == '' || href.charAt(0) == '#' || (rel && rel == 'external') || href.indexOf('//') > -1) return true\n\n    return false\n\n  }\n\n  loadRoutes() {\n\n    this.options.routes(this)\n\n  }\n\n  navigate(path, options = {}) {\n\n    this._history[options.replace ? 'replaceState' : 'pushState']({}, document.title, path)\n    this.onUrlChange()\n\n  }\n\n  onLinkClick(e) {\n\n    var el = e.target\n\n    if(el.nodeName == 'A') {\n\n      if(this.isIgnoredLink(el)) return\n\n      /*if(external) {\n        window.open(href)\n      }*/\n\n      e.preventDefault()\n\n      this.navigate(el.href)\n\n    }\n\n  }\n\n  onUrlChange() {\n\n    var matched = false,\n        path    = this.getPath()\n\n    for(var i = 0, l = this._routes.length; i < l; i++) {\n\n      var item    = this._routes[i],\n          options = item.options,\n          route   = item.route\n\n      if(route.regExp.test(path)) {\n\n        var params = route.extractParams(path)\n\n        this.emit('match', route, params, options)\n        matched = true\n\n        break\n      }\n\n    }\n\n  }\n\n  start(options = {}) {\n\n    if(this._started) return console.error('Router already started.')\n\n    this._started = true\n\n    this._usePushState = true\n\n    window.addEventListener('popstate', this.onUrlChange.bind(this), false)\n\n    // popstate doesn't fire on page load\n    this.onUrlChange()\n\n  }\n\n  stop() {\n\n    if(!this._started) return\n\n    window.removeEventListener('popstate', this.onUrlChange, false)\n\n    this._started = false\n\n  }\n\n  use() {\n\n\n\n  }\n\n}\n\nObject.assign(Router.prototype, {mixin})\n\nexport {Route}\n\nexport default Router\n"]}